# WeatherWidget & WeatherService ë¦¬íŒ©í„°ë§ ì„¤ê³„ì„œ

## 0. í˜„ì¬ ë¬¸ì œ ì§„ë‹¨ ë° í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë¬¸ì œ 1: ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜
**ì¬í˜„**:
- WeatherWidget.tsx:525ì—ì„œ `hour.timestamp` ì‚¬ìš©
- weatherService.ts:585ì—ì„œ ì‹œë®¬ë ˆì´ì…˜ì€ `time` í•„ë“œ ì‚¬ìš©
- DailyForecast ì¸í„°í˜ì´ìŠ¤ëŠ” `temperature: {min, max}`ì¸ë°, ì‹œë®¬ë ˆì´ì…˜ì€ `maxTemperature/minTemperature` ì‚¬ìš©

**ìˆ˜ì •**:
- ë‹¨ì¼ í‘œì¤€ ìŠ¤í‚¤ë§ˆ ì •ì˜ (ì„œë¹„ìŠ¤ ê³„ì¸µ)
- ëª¨ë“  í”„ë¡œë°”ì´ë”/ì‹œë®¬ë ˆì´í„°ê°€ í‘œì¤€ ìŠ¤í‚¤ë§ˆë¡œ ë³€í™˜í•˜ë„ë¡ ì–´ëŒ‘í„° íŒ¨í„´ ì ìš©
- ì¸í„°í˜ì´ìŠ¤ í•„ë“œëª… í†µì¼: `timestamp` (HourlyForecast), `temperature: {min, max}` (DailyForecast)

**ê²€ì¦**:
- ëª¨ë“  í”„ë¡œë°”ì´ë”ì—ì„œ ë™ì¼í•œ í•„ë“œëª…ìœ¼ë¡œ ë°ì´í„° ë°˜í™˜ í™•ì¸
- TypeScript íƒ€ì… ì²´í¬ í†µê³¼

---

### ë¬¸ì œ 2: condition/description/icon í˜¼ì¬
**ì¬í˜„**:
- OpenWeather: `condition: 'Clear'`, `description: 'clear sky'` (ì˜ë¬¸)
- ì‹œë®¬ë ˆì´í„°: `condition: 'ë§‘ìŒ'` (í•œê¸€)
- icon: ì´ëª¨ì§€ vs OWM ì½”ë“œ ('01d') í˜¼ì¬

**ìˆ˜ì •**:
- í‘œì¤€ ìŠ¤í‚¤ë§ˆ: `conditionCode` (enum: clear/clouds/rain/snow/thunder/drizzle/mist/fog/haze)
- `conditionKo` (í‘œì‹œìš© í•œê¸€ ë¼ë²¨)
- `iconCode` (OWM ìŠ¤íƒ€ì¼: '01d', '01n' ë“±) â†’ ìœ„ì ¯ì—ì„œ ì´ëª¨ì§€/ì´ë¯¸ì§€ë¡œ ë³€í™˜

**ê²€ì¦**:
- ëª¨ë“  í”„ë¡œë°”ì´ë”ì—ì„œ conditionCode enumìœ¼ë¡œ ë°˜í™˜
- iconCode ì¼ê´€ì„± í™•ì¸

---

### ë¬¸ì œ 3: ë‹¨ìœ„/í¬ë§· ë¶ˆì¼ì¹˜
**ì¬í˜„**:
- ì„œë¹„ìŠ¤ëŠ” í•­ìƒ SI (Celsius, m/s, m, hPa)ë¡œ ë‚´ë ¤ì¤Œ
- ìœ„ì ¯ì€ units(metric|imperial)ë¡œ í‘œì‹œ í¬ë§·ë§Œ ë³€ê²½
- í’ì†/ê°€ì‹œê±°ë¦¬/ê¸°ì•• í™˜ì‚° ëˆ„ë½ (í˜„ì¬ëŠ” ì˜¨ë„ë§Œ ë³€í™˜)

**ìˆ˜ì •**:
- ì„œë¹„ìŠ¤ëŠ” í•­ìƒ SI ìœ ì§€ (ë‹¨ì¼ ì§„ì‹¤ì›ë³¸)
- ìœ„ì ¯ì—ì„œ weatherUnits ìœ í‹¸ë¡œ ëª¨ë“  ë‹¨ìœ„ ë³€í™˜ (ì˜¨ë„/í’ì†/ê±°ë¦¬/ê¸°ì••)

**ê²€ì¦**:
- metric â†” imperial ì „í™˜ ì‹œ ëª¨ë“  ê°’ì´ ì •í™•íˆ ë³€í™˜ë¨
- ì°¸ê°’ ëŒ€ë¹„ ì˜¤ì°¨ í—ˆìš© ë²”ìœ„ ë‚´ (Â±0.1Â°C, Â±0.1 km/h, Â±0.01 inHg)

---

### ë¬¸ì œ 4: visibilitychange ë¦¬ìŠ¤ë„ˆ í•´ì œ ì‹¤íŒ¨
**ì¬í˜„**:
- WeatherWidget.tsx:195ì—ì„œ `removeEventListener('visibilitychange', () => {})` â†’ ë¹ˆ í•¨ìˆ˜ë¡œ í•´ì œ ì‹¤íŒ¨

**ìˆ˜ì •**:
- ë™ì¼ ì°¸ì¡° ìœ ì§€: `useCallback`ìœ¼ë¡œ í•¸ë“¤ëŸ¬ ë©”ëª¨ì´ì œì´ì…˜
- `useRef`ë¡œ íƒ€ì´ë¨¸ ì°¸ì¡° ë³´ê´€í•˜ì—¬ ì •í™•í•œ cleanup

**ê²€ì¦**:
- íƒ­ ì „í™˜ ì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¤‘ë³µ ì—†ìŒ
- ë©”ëª¨ë¦¬ ë¦­ ì—†ìŒ (DevTools í™•ì¸)

---

### ë¬¸ì œ 5: AbortController/ê²½í•© ì·¨ì†Œ ë¶€ì¬
**ì¬í˜„**:
- ì—°ì† ìœ„ì¹˜ ë³€ê²½ ì‹œ ì´ì „ ìš”ì²­ì´ ì™„ë£Œë˜ì–´ ìµœì‹  ë°ì´í„° ë®ì–´ì“°ê¸° ê°€ëŠ¥

**ìˆ˜ì •**:
- ê° ìš”ì²­ì— `AbortController` í• ë‹¹
- ìƒˆ ìš”ì²­ ì‹œ ì´ì „ ìš”ì²­ abort
- ê²½í•© ë°©ì§€: ìš”ì²­ IDë¡œ ìµœì‹  ìš”ì²­ë§Œ ë°˜ì˜

**ê²€ì¦**:
- ì—°ì† ìœ„ì¹˜ ë³€ê²½ ì‹œ ìµœì‹  ë°ì´í„°ë§Œ ë°˜ì˜
- ì·¨ì†Œëœ ìš”ì²­ ì‘ë‹µ ë¬´ì‹œ í™•ì¸

---

### ë¬¸ì œ 6: ì˜¤í”„ë¼ì¸/ì—ëŸ¬ ì²˜ë¦¬ ë¯¸í¡
**ì¬í˜„**:
- ì˜¤í”„ë¼ì¸ ì‹œ UI ì•Œë¦¼ì€ ìˆìœ¼ë‚˜, ìºì‹œëœ ë§ˆì§€ë§‰ ì •ìƒ ë°ì´í„° ì¬í‘œì‹œ(Last Known Good) ì „ëµ ë¬¸ì„œí™” ë¶€ì¬

**ìˆ˜ì •**:
- ì˜¤í”„ë¼ì¸ ê°ì§€: `navigator.onLine` + `online/offline` ì´ë²¤íŠ¸
- Last Known Good: ë§ˆì§€ë§‰ ì •ìƒ ë°ì´í„° LocalStorageì— ì €ì¥ (TTL ë¬´ì‹œ)
- ì˜¤í”„ë¼ì¸ ë°°ì§€ í‘œì‹œ + "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: Xë¶„ ì „" í‘œì‹œ

**ê²€ì¦**:
- ë„¤íŠ¸ì›Œí¬ ì°¨ë‹¨ í›„ ë§ˆì§€ë§‰ ì •ìƒ ë°ì´í„° í‘œì‹œ
- ì˜¨ë¼ì¸ ë³µê·€ ì‹œ ìë™ ê°±ì‹ 

---

### ë¬¸ì œ 7: OpenWeather ì¼ë³„ ì§‘ê³„ ë¡œì§ ê°„ëµ
**ì¬í˜„**:
- weatherService.ts:272-296ì—ì„œ 3ì‹œê°„ ê°„ê²© ë°ì´í„°ë¡œ ì¼ë³„ ì§‘ê³„
- ë‹¨ìˆœ min/maxë§Œ ê³„ì‚°, ì¤‘ë³µ/ëˆ„ë½ ê°€ëŠ¥ì„±
- ì¼ì¶œ/ì¼ëª° ë¯¸ì „ë‹¬

**ìˆ˜ì •**:
- ì¼ë³„ ì§‘ê³„ ì•Œê³ ë¦¬ì¦˜ ëª…ì„¸í™”:
  - ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™” (íƒ€ì„ì¡´ ê¸°ì¤€)
  - min/max ì˜¨ë„: ì „ì²´ ë°ì´í„°ì—ì„œ ì‹¤ì œ ìµœì†Œ/ìµœëŒ€ê°’
  - ê°•ìˆ˜ëŸ‰: í•©ê³„ (ì¤‘ë³µ ì œê±°)
  - POP: ìµœëŒ€ê°’ ë˜ëŠ” í‰ê·  (ì •ì±… ëª…ì‹œ)
  - ì¼ì¶œ/ì¼ëª°: APIì—ì„œ ì œê³µ ì‹œ ì‚¬ìš©, ì—†ìœ¼ë©´ ê³„ì‚°

**ê²€ì¦**:
- ê²½ê³„ì¼(ìì • êµì°¨) ë°ì´í„° ì •í™•ë„ í™•ì¸
- ì¼ì¶œ/ì¼ëª° ì •í™•ë„ í™•ì¸

---

## 1. ë°ì´í„° ìŠ¤í‚¤ë§ˆ í‘œì¤€í™” (ë‹¨ì¼ ì§„ì‹¤ì›ë³¸: ì„œë¹„ìŠ¤ ê³„ì¸µ)

### 1.1 í‘œì¤€ ìŠ¤í‚¤ë§ˆ ì •ì˜

#### CurrentWeather
```typescript
interface CurrentWeather {
  // ìœ„ì¹˜
  location: WeatherLocation;
  
  // ì˜¨ë„ (SI: Celsius)
  temperatureC: number;           // Â°C
  feelsLikeC: number;             // ì²´ê° ì˜¨ë„ Â°C
  
  // í’ì†/í’í–¥ (SI: m/s)
  windSpeedMS: number;            // m/s
  windDirection: number;          // degrees (0-360)
  
  // ê°€ì‹œê±°ë¦¬ (SI: meters)
  visibilityM: number;            // meters
  
  // ê¸°ì•• (SI: hPa)
  pressureHpa: number;           // hPa
  
  // ê¸°íƒ€
  humidity: number;               // % (0-100)
  uvIndex?: number;               // 0-11+
  
  // ì¼ì¶œ/ì¼ëª° (KST timestamp)
  sunriseTs?: number;             // Unix timestamp (ms)
  sunsetTs?: number;              // Unix timestamp (ms)
  
  // ë‚ ì”¨ ìƒíƒœ (í‘œì¤€í™”)
  conditionCode: WeatherCondition;  // enum
  conditionKo: string;            // í‘œì‹œìš© í•œê¸€ ë¼ë²¨
  iconCode: string;                // '01d', '01n' ë“±
  
  // ë©”íƒ€ë°ì´í„°
  timestamp: number;              // Unix timestamp (ms)
  provider: string;                // 'openweather' | 'simulation'
}
```

#### HourlyForecast
```typescript
interface HourlyForecast {
  timestamp: number;              // Unix timestamp (ms) - KST ê¸°ì¤€
  tempC: number;                   // Â°C
  feelsLikeC: number;              // ì²´ê° ì˜¨ë„ Â°C
  pop: number;                     // ê°•ìˆ˜ í™•ë¥  % (0-100)
  precipMm: number;                // ê°•ìˆ˜ëŸ‰ mm
  iconCode: string;                // '01d', '09n' ë“±
  conditionCode: WeatherCondition;
  conditionKo: string;
  windSpeedMS: number;             // m/s
  humidity: number;                // %
}
```

#### DailyForecast
```typescript
interface DailyForecast {
  date: string;                    // 'YYYY-MM-DD' (KST ê¸°ì¤€)
  timestamp: number;               // í•´ë‹¹ ë‚ ì§œ 00:00 KST Unix timestamp
  minC: number;                    // ìµœì € ì˜¨ë„ Â°C
  maxC: number;                    // ìµœê³  ì˜¨ë„ Â°C
  pop: number;                     // ê°•ìˆ˜ í™•ë¥  % (0-100)
  precipMm: number;               // ê°•ìˆ˜ëŸ‰ mm
  iconCode: string;                // ëŒ€í‘œ ì•„ì´ì½˜
  conditionCode: WeatherCondition;
  conditionKo: string;
  sunriseTs?: number;              // ì¼ì¶œ timestamp
  sunsetTs?: number;               // ì¼ëª° timestamp
  windSpeedMS: number;             // m/s (í‰ê·  ë˜ëŠ” ìµœëŒ€)
  humidity: number;                // % (í‰ê· )
}
```

#### WeatherCondition Enum
```typescript
type WeatherCondition = 
  | 'clear' 
  | 'clouds' 
  | 'rain' 
  | 'snow' 
  | 'thunder' 
  | 'drizzle' 
  | 'mist' 
  | 'fog' 
  | 'haze';
```

### 1.2 í”„ë¡œë°”ì´ë” ì–´ëŒ‘í„° ë§¤í•‘í‘œ

#### OpenWeatherMap â†’ í‘œì¤€ ìŠ¤í‚¤ë§ˆ
| OpenWeather í•„ë“œ | í‘œì¤€ ìŠ¤í‚¤ë§ˆ í•„ë“œ | ë³€í™˜ ê·œì¹™ |
|-----------------|----------------|----------|
| `main.temp` | `temperatureC` | ì§ì ‘ ì‚¬ìš© (ì´ë¯¸ Celsius) |
| `main.feels_like` | `feelsLikeC` | ì§ì ‘ ì‚¬ìš© |
| `wind.speed` | `windSpeedMS` | ì§ì ‘ ì‚¬ìš© (ì´ë¯¸ m/s) |
| `wind.deg` | `windDirection` | ì§ì ‘ ì‚¬ìš© |
| `visibility` | `visibilityM` | ì§ì ‘ ì‚¬ìš© (ì´ë¯¸ meters) |
| `main.pressure` | `pressureHpa` | ì§ì ‘ ì‚¬ìš© |
| `main.humidity` | `humidity` | ì§ì ‘ ì‚¬ìš© |
| `weather[0].main` | `conditionCode` | ë§¤í•‘í‘œ ì ìš© (Clearâ†’clear, Cloudsâ†’clouds ë“±) |
| `weather[0].description` | `conditionKo` | ì–¸ì–´ ë§µ ì ìš© ë˜ëŠ” ë²ˆì—­ |
| `weather[0].icon` | `iconCode` | ì§ì ‘ ì‚¬ìš© ('01d', '01n' ë“±) |
| `sys.sunrise` | `sunriseTs` | `* 1000` (ì´ˆâ†’ë°€ë¦¬ì´ˆ) |
| `sys.sunset` | `sunsetTs` | `* 1000` |

#### ì‹œë®¬ë ˆì´í„° â†’ í‘œì¤€ ìŠ¤í‚¤ë§ˆ
| ì‹œë®¬ë ˆì´í„° í•„ë“œ | í‘œì¤€ ìŠ¤í‚¤ë§ˆ í•„ë“œ | ë³€í™˜ ê·œì¹™ |
|---------------|----------------|----------|
| `temperature` | `temperatureC` | ì§ì ‘ ì‚¬ìš© |
| `condition` (í•œê¸€) | `conditionCode` | í•œê¸€â†’ì˜ë¬¸ ë§¤í•‘í‘œ ì ìš© ('ë§‘ìŒ'â†’'clear') |
| `condition` | `conditionKo` | ì§ì ‘ ì‚¬ìš© |
| `icon` (ì´ëª¨ì§€) | `iconCode` | ì´ëª¨ì§€â†’OWM ì½”ë“œ ë§¤í•‘í‘œ |

### 1.3 ì•„ì´ì½˜/ì¡°ê±´ ì½”ë“œ ë§¤í•‘í‘œ

#### OWM ì•„ì´ì½˜ ì½”ë“œ â†’ ì´ëª¨ì§€/ì´ë¯¸ì§€
| iconCode | ë‚® (d) | ë°¤ (n) | ì„¤ëª… |
|---------|--------|--------|------|
| `01d` | â˜€ï¸ | - | ë§‘ìŒ |
| `01n` | - | ğŸŒ™ | ë§‘ìŒ (ë°¤) |
| `02d` | â›… | - | ì•½ê°„ íë¦¼ |
| `02n` | - | â˜ï¸ | ì•½ê°„ íë¦¼ (ë°¤) |
| `03d/03n` | â˜ï¸ | â˜ï¸ | íë¦¼ |
| `04d/04n` | â˜ï¸ | â˜ï¸ | ë§¤ìš° íë¦¼ |
| `09d/09n` | ğŸŒ§ï¸ | ğŸŒ§ï¸ | ì†Œë‚˜ê¸° |
| `10d` | ğŸŒ¦ï¸ | - | ë¹„ (ë‚®) |
| `10n` | - | ğŸŒ§ï¸ | ë¹„ (ë°¤) |
| `11d/11n` | â›ˆï¸ | â›ˆï¸ | ë‡Œìš° |
| `13d/13n` | â„ï¸ | â„ï¸ | ëˆˆ |
| `50d/50n` | ğŸŒ«ï¸ | ğŸŒ«ï¸ | ì•ˆê°œ |

#### ì¡°ê±´ ì½”ë“œ â†’ í•œê¸€ ë¼ë²¨
| conditionCode | conditionKo |
|--------------|------------|
| `clear` | ë§‘ìŒ |
| `clouds` | êµ¬ë¦„ ë§ìŒ |
| `rain` | ë¹„ |
| `snow` | ëˆˆ |
| `thunder` | ë‡Œìš° |
| `drizzle` | ì´ìŠ¬ë¹„ |
| `mist` | ì•ˆê°œ |
| `fog` | ì§™ì€ ì•ˆê°œ |
| `haze` | ì—°ë¬´ |

---

## 2. ë‹¨ìœ„/í¬ë§· ì „ëµ (ë·° ê³„ì¸µ ì „ìš©)

### 2.1 ë³€í™˜ ê·œì¹™

ëª¨ë“  ë³€í™˜ì€ `weatherUnits.ts`ì˜ í—¬í¼ í•¨ìˆ˜ ì‚¬ìš©:

#### ì˜¨ë„ ë³€í™˜
- Celsius â†’ Fahrenheit: `C * 9/5 + 32`
- ìœ„ì ¯ í‘œì‹œ: `formatTemperature(celsius, units)`

#### í’ì† ë³€í™˜
- metric: `m/s â†’ km/h` (Ã— 3.6)
- imperial: `m/s â†’ mph` (Ã— 2.237)
- ìœ„ì ¯ í‘œì‹œ: `formatWindSpeed(metersPerSecond, units)`

#### ê±°ë¦¬ ë³€í™˜
- metric: `m â†’ km` (Ã· 1000)
- imperial: `m â†’ miles` (Ã— 0.000621371)
- ìœ„ì ¯ í‘œì‹œ: `formatDistance(meters, units)`

#### ê¸°ì•• ë³€í™˜
- metric: `hPa` (ê·¸ëŒ€ë¡œ)
- imperial: `hPa â†’ inHg` (Ã— 0.02953)
- ìœ„ì ¯ í‘œì‹œ: `formatPressure(hPa, units)`

#### ê°•ìˆ˜ëŸ‰ ë³€í™˜
- metric: `mm` (ê·¸ëŒ€ë¡œ)
- imperial: `mm â†’ inches` (Ã— 0.0393701)
- ìœ„ì ¯ í‘œì‹œ: `formatPrecipitation(mm, units)`

### 2.2 ì‚¬ìš© ê·œì¹™
- ì„œë¹„ìŠ¤ëŠ” í•­ìƒ SI ë°˜í™˜ (ë‹¨ì¼ ì§„ì‹¤ì›ë³¸)
- ìœ„ì ¯ì€ `units` ìƒíƒœì— ë”°ë¼ ë·° í¬ë§·ë§Œ ë³€í™˜
- ë³€í™˜ì€ í•­ìƒ `weatherUnits.ts` í—¬í¼ ì‚¬ìš© (ì¤‘ë³µ ì œê±°)

---

## 3. ìºì‹œ/ë„¤íŠ¸ì›Œí‚¹/íšŒë³µë ¥

### 3.1 ìºì‹œ ì •ì±…

#### ìºì‹œ í‚¤ í˜•ì‹
```
{provider}:{lat}:{lon}:{type}:{rounding}
```
- `provider`: 'openweather' | 'simulation'
- `lat`: 0.1Â° ë‹¨ìœ„ ë°˜ì˜¬ë¦¼ (ì˜ˆ: 37.5665 â†’ 37.6)
- `lon`: 0.1Â° ë‹¨ìœ„ ë°˜ì˜¬ë¦¼ (ì˜ˆ: 126.9780 â†’ 126.9)
- `type`: 'current' | 'hourly' | 'daily'
- `rounding`: í•­ìƒ '0.1' (ê³ ì •)

ì˜ˆì‹œ: `openweather:37.6:126.9:current:0.1`

#### TTL (Time To Live)
- `current`: 5ë¶„ (300,000ms)
- `hourly`: 30ë¶„ (1,800,000ms)
- `daily`: 60ë¶„ (3,600,000ms)

#### ìºì‹œ ê³„ì¸µ
1. **In-Memory Cache**: Map<string, {data, timestamp, ttl}>
2. **LocalStorage Cache** (ì˜µì…˜): ë™ì¼ í‚¤ + versioning

#### Stale-While-Revalidate (SWR)
- ìºì‹œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ (stale í—ˆìš©)
- ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒˆë¡œê³ ì¹¨
- ìƒˆ ë°ì´í„° ë„ì°© ì‹œ UI ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ì—†ìŒ)

### 3.2 ìš”ì²­ ì·¨ì†Œ/ê²½í•© ë°©ì§€

#### AbortController íŒ¨í„´
```typescript
// ê° ìš”ì²­ì— ê³ ìœ  ID ë¶€ì—¬
const requestId = `${location.lat}-${location.lon}-${Date.now()}`;
const abortController = new AbortController();

// ì´ì „ ìš”ì²­ ì·¨ì†Œ
if (previousAbortController) {
  previousAbortController.abort();
}

// ìƒˆ ìš”ì²­ ì €ì¥
previousAbortController = abortController;

// fetch ì‹œ signal ì „ë‹¬
fetch(url, { signal: abortController.signal })
```

#### ê²½í•© ë°©ì§€
- ìš”ì²­ IDë¡œ ìµœì‹  ìš”ì²­ë§Œ ë°˜ì˜
- ì·¨ì†Œëœ ìš”ì²­ ì‘ë‹µ ë¬´ì‹œ

### 3.3 ì¬ì‹œë„/ë°±ì˜¤í”„

#### ì§€ìˆ˜ ë°±ì˜¤í”„ ì „ëµ
```
delay = baseDelay * (2 ^ attempt)
```
- `baseDelay`: 1000ms
- `attempt`: 0, 1, 2, ...
- ìµœëŒ€ ì¬ì‹œë„: 3íšŒ

#### HTTP ìƒíƒœ ì½”ë“œë³„ ì²˜ë¦¬
- `429` (Rate Limit): ë°±ì˜¤í”„ í›„ ì¬ì‹œë„
- `5xx` (ì„œë²„ ì˜¤ë¥˜): ë°±ì˜¤í”„ í›„ ì¬ì‹œë„
- `4xx` (í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜): ì¬ì‹œë„ ì—†ìŒ (ì—ëŸ¬ ë°˜í™˜)

### 3.4 í”„ë¡œë°”ì´ë” í˜ì¼ì˜¤ë²„

#### ìˆœì°¨ ì‹œë„
1. OpenWeatherMap (primary)
2. SimulationProvider (fallback)

#### í˜ì¼ì˜¤ë²„ ì¡°ê±´
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
- API í‚¤ ì˜¤ë¥˜
- Rate Limit ì´ˆê³¼
- íƒ€ì„ì•„ì›ƒ (10ì´ˆ)

### 3.5 ì˜¤í”„ë¼ì¸ ëª¨ë“œ

#### Last Known Good ì „ëµ
- ë§ˆì§€ë§‰ ì •ìƒ ë°ì´í„°ë¥¼ LocalStorageì— ì €ì¥ (TTL ë¬´ì‹œ)
- ì˜¤í”„ë¼ì¸ ì‹œ ì¦‰ì‹œ í‘œì‹œ
- "ì˜¤í”„ë¼ì¸" ë°°ì§€ + "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: Xë¶„ ì „" í‘œì‹œ

#### ì˜¨ë¼ì¸ ë³µê·€
- `online` ì´ë²¤íŠ¸ ê°ì§€
- ìë™ ì¬ì‹œë„ (ìµœëŒ€ 1íšŒ)
- ì„±ê³µ ì‹œ ë°°ì§€ ì œê±°

---

## 4. ìë™ ìƒˆë¡œê³ ì¹¨/ê°€ì‹œì„±

### 4.1 ê°€ì‹œì„± ê¸°ë°˜ ê°±ì‹ 

#### ê·œì¹™
- ê°€ì‹œ ì˜ì—­ì— ìˆì„ ë•Œë§Œ ìë™ ê°±ì‹ 
- íƒ­ ë¹„í™œì„± ì‹œ ì¤‘ì§€
- `prefers-reduced-motion` ê°ì§€ ì‹œ ë¹ˆë„ ì¶•ì†Œ

#### êµ¬í˜„ ì „ëµ
- `IntersectionObserver`ë¡œ ìœ„ì ¯ ê°€ì‹œì„± ê°ì§€
- `document.visibilityState`ë¡œ íƒ­ í™œì„± ìƒíƒœ ê°ì§€
- ë™ì¼ ì°¸ì¡° ìœ ì§€: `useCallback` + `useRef`

### 4.2 ìë™ ìƒˆë¡œê³ ì¹¨ ì„¤ì •

#### ì‚¬ìš©ì ì„¤ì •
- `autoRefresh`: boolean (ê¸°ë³¸ true)
- `refreshInterval`: number (ë¶„ ë‹¨ìœ„, ê¸°ë³¸ 10ë¶„)

#### ì‹¤í–‰ ì¡°ê±´
- `autoRefresh === true`
- `document.visibilityState === 'visible'`
- `navigator.onLine === true`
- ìœ„ì ¯ì´ ê°€ì‹œ ì˜ì—­ì— ìˆìŒ

### 4.3 ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ê´€ë¦¬

#### ë“±ë¡/í•´ì œ ê·œì¹™
- ë™ì¼ ì°¸ì¡° ìœ ì§€: `useCallback`ìœ¼ë¡œ í•¸ë“¤ëŸ¬ ë©”ëª¨ì´ì œì´ì…˜
- `useRef`ë¡œ íƒ€ì´ë¨¸ ì°¸ì¡° ë³´ê´€
- cleanupì—ì„œ ì •í™•í•œ ì°¸ì¡°ë¡œ í•´ì œ

---

## 5. ìœ„ì¹˜/íƒ€ì„ì¡´/ì§€ì˜¤ì½”ë”©

### 5.1 ìœ„ì¹˜ ê²€ìƒ‰ (ì§€ì˜¤ì½”ë”©)

#### ë¡œì»¬ ë§¤í•‘ (1ì°¨)
- ì£¼ìš” ë„ì‹œëª… ë§¤í•‘ (í•œê¸€/ì˜ë¬¸/ë¡œë§ˆì)
- ì˜¤íƒ€ êµì • ê·œì¹™ (ì˜ˆ: 'seo ul' â†’ 'ì„œìš¸')

#### ì™¸ë¶€ ì§€ì˜¤ì½”ë”© API (2ì°¨, ì˜µì…˜)
- OpenWeatherMap Geocoding API
- ë˜ëŠ” Google Geocoding API

#### ì¿¼ë¦¬ ì •ê·œí™”
- ê³µë°± ì œê±°
- ì†Œë¬¸ì ë³€í™˜
- í•œê¸€/ì˜ë¬¸/ë¡œë§ˆì í†µí•© ê²€ìƒ‰

### 5.2 ì¢Œí‘œ â†’ íƒ€ì„ì¡´

#### íƒ€ì„ì¡´ ë³´ì •
- `Intl.DateTimeFormat().resolvedOptions().timeZone` ë˜ëŠ”
- ì¢Œí‘œ ê¸°ë°˜ íƒ€ì„ì¡´ DB (ì˜ˆ: `geo-tz` ë¼ì´ë¸ŒëŸ¬ë¦¬)
- ì¼ì¶œ/ì¼ëª° ê³„ì‚° ì‹œ íƒ€ì„ì¡´ ê³ ë ¤

### 5.3 í˜„ì¬ ìœ„ì¹˜ ê°ì§€

#### ê¶Œí•œ ì²˜ë¦¬
- ê±°ë¶€: ì•ˆë‚´ ë©”ì‹œì§€ + ìˆ˜ë™ ì…ë ¥ ìœ ë„
- íƒ€ì„ì•„ì›ƒ (10ì´ˆ): ì¬ì‹œë„ ë²„íŠ¼ ì œê³µ
- ì •í™•ë„ ë‚®ìŒ: ê²½ê³  í‘œì‹œ (ì„ íƒì )

---

## 6. UI/UX ëª…ì„¸

### 6.1 ê³µí†µ ìš”ì†Œ

#### ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”©
- í…ìŠ¤íŠ¸ í”Œë ˆì´ìŠ¤í™€ë” (3ì¤„)
- ì• ë‹ˆë©”ì´ì…˜: `animate-pulse`

#### ì—ëŸ¬ ë¹ˆ ìƒíƒœ
- ì•„ì´ì½˜: `AlertCircle`
- ë©”ì‹œì§€: "ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
- ì¬ì‹œë„ ë²„íŠ¼

#### lastUpdated í‘œì‹œ
- ìƒëŒ€ ì‹œê°„: "3ë¶„ ì „", "ë°©ê¸ˆ ì „"
- ì ˆëŒ€ ì‹œê°„ (ì˜µì…˜): "14:30"

#### Settings ëª¨ë‹¬/íŒ¨ë„
- ìœ„ì¹˜ ì…ë ¥: ìœ íš¨ì„± ê²€ì‚¬ í›„ í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ì ìš©
- ë‹¨ìœ„ í† ê¸€: ì¦‰ì‹œ ì ìš©
- ìë™ ìƒˆë¡œê³ ì¹¨: í† ê¸€ ì¦‰ì‹œ ì ìš©

### 6.2 í¬ê¸°ë³„ ë ˆì´ì•„ì›ƒ

#### 1x1 (ìµœì†Œ)
- í˜„ì¬ ì˜¨ë„ (í° ê¸€ì”¨)
- ë‚ ì”¨ ì•„ì´ì½˜
- ë„ì‹œëª…
- ë‚ ì”¨ ìƒíƒœ (ì‘ì€ ê¸€ì”¨)
- ì˜¤í”„ë¼ì¸ ë°°ì§€ (ì˜µì…˜)
- ì„¤ì • ë²„íŠ¼ (í¸ì§‘ ëª¨ë“œë§Œ)

#### 1x2 (+ ì‹œê°„ë³„)
- 1x1 ë‚´ìš©
- ì‹œê°„ë³„ ì˜ˆë³´ 8ê°œ (ê°€ë¡œ ìŠ¤í¬ë¡¤)
  - ì‹œê°„ (HH:mm)
  - ì•„ì´ì½˜
  - ì˜¨ë„
  - ê°•ìˆ˜ëŸ‰ (ì˜µì…˜)

#### 1x3 (+ ì¼ë³„)
- 1x2 ë‚´ìš©
- ìƒì„¸ ì •ë³´ ê·¸ë¦¬ë“œ (ìŠµë„/í’ì†/ê°€ì‹œê±°ë¦¬/ê¸°ì••)
- ì¼ë³„ ì˜ˆë³´ 5-7ì¼
  - ë‚ ì§œ (ì˜¤ëŠ˜/ë‚´ì¼/ìš”ì¼)
  - ì•„ì´ì½˜
  - ìµœì €/ìµœê³  ì˜¨ë„
  - ê°•ìˆ˜ëŸ‰/POP

### 6.3 ì•„ì´ì½˜/ì»¬ëŸ¬

#### ì¡°ê±´ ì½”ë“œ ê¸°ë°˜ ìƒ‰ìƒ
- `clear`: ë…¸ë€ìƒ‰ (`text-yellow-600`)
- `rain`: íŒŒë€ìƒ‰ (`text-blue-600`)
- `snow`: ì—°í•œ íŒŒë€ìƒ‰ (`text-blue-300`)
- `clouds`: íšŒìƒ‰ (`text-gray-600`)
- `thunder`: ë³´ë¼ìƒ‰ (`text-purple-600`)

#### ì•¼ê°„ í…Œë§ˆ
- `*n` ì•„ì´ì½˜ ì½”ë“œì¼ ë•Œ ì–´ë‘ìš´ ìƒ‰ìƒ ì ìš©
- ë‹¤í¬ëª¨ë“œ ìë™ ëŒ€ì‘

---

## 7. ì ‘ê·¼ì„± (A11y) & ë¶„ì„

### 7.1 ì ‘ê·¼ì„±

#### ARIA ì†ì„±
- ìƒíƒœ ë³€í™”: `aria-live="polite"` ì˜ì—­
- ë²„íŠ¼: `aria-label`, `aria-pressed`
- í‚¤ë³´ë“œ í¬ì»¤ìŠ¤ ìˆœì„œ: ë…¼ë¦¬ì  ìˆœì„œ

#### í‚¤ë³´ë“œ ì¡°ì‘
- Enter: ì„¤ì • í™•ì¸
- Escape: ì„¤ì • ë‹«ê¸°
- Tab: í¬ì»¤ìŠ¤ ì´ë™

#### ìƒ‰ ëŒ€ë¹„
- í…ìŠ¤íŠ¸/ë°°ê²½: 4.5:1 ì´ìƒ (WCAG AA)
- ë‹¤í¬ëª¨ë“œ ì§€ì›

#### Motion ê°ì†Œ
- `prefers-reduced-motion` ê°ì§€ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ìµœì†Œí™”

### 7.2 ë¶„ì„ ì´ë²¤íŠ¸

#### ì´ë²¤íŠ¸ ì¢…ë¥˜
- `weather_refresh`: ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨
- `weather_location_change`: ìœ„ì¹˜ ë³€ê²½
- `weather_units_change`: ë‹¨ìœ„ ë³€ê²½
- `weather_provider_failover`: í”„ë¡œë°”ì´ë” í˜ì¼ì˜¤ë²„
- `weather_offline_view`: ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ì¡°íšŒ

#### ê³µí†µ íŒŒë¼ë¯¸í„°
```typescript
{
  provider: string;
  lat: number;
  lon: number;
  ttlHit: boolean;      // ìºì‹œì—ì„œ ê°€ì ¸ì™”ëŠ”ì§€
  swr: boolean;         // SWRë¡œ í‘œì‹œí–ˆëŠ”ì§€
}
```

---

## 8. ë³´ì•ˆ/ë°°í¬

### 8.1 API í‚¤ ë…¸ì¶œ ë°©ì§€

#### ì„œë²„ í”„ë¡ì‹œ ì „ëµ
- Edge Function (Vercel/Cloudflare)ë¡œ í‚¤ ë¹„ê³µê°œ
- í´ë¼ì´ì–¸íŠ¸ëŠ” í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
- ì‘ë‹µ ìºì‹œ (ETag/Cache-Control)

#### í”„ë¡ì‹œ API ê³„ì•½ì„œ
```
GET /api/weather/current?lat=37.5665&lon=126.9780
â†’ í”„ë¡ì‹œê°€ OpenWeather API í˜¸ì¶œ
â†’ ì‘ë‹µ ìºì‹œ í—¤ë” ì¶”ê°€
â†’ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°˜í™˜
```

### 8.2 ì¿¼í„° ë³´í˜¸

#### Rate Limit
- ì‚¬ìš©ìë³„ ìƒ˜í”Œë§: ìµœëŒ€ NíšŒ/ì‹œê°„
- í”„ë¡ì‹œì—ì„œ rate limit ì ìš©
- ì´ˆê³¼ ì‹œ 429 ì‘ë‹µ

---

## 9. ë§ˆì´ê·¸ë ˆì´ì…˜

### 9.1 ë²„ì „ í‚¤
- ê¸°ì¡´: `weather_${widgetId}`
- ì‹ ê·œ: `weather_state_v2_${widgetId}`

### 9.2 ë³€í™˜ ê·œì¹™

#### ê¸°ì¡´ ì €ì¥ê°’ â†’ ì‹ ê·œ ìŠ¤í‚¤ë§ˆ
- `location` ë¬¸ìì—´ â†’ `location: {name, lat, lon}` ê°ì²´
- `hour.time` â†’ `hour.timestamp`
- `day.maxTemperature/minTemperature` â†’ `day.temperature: {min, max}`
- `condition` í•œê¸€ â†’ `conditionCode` enum + `conditionKo`
- `icon` ì´ëª¨ì§€ â†’ `iconCode` OWM ìŠ¤íƒ€ì¼

### 9.3 ë¡¤ë°± í”Œëœ
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨ ì‹œ ì½ê¸° ì „ìš© ëª¨ë“œ
- ê¸°ì¡´ ë°ì´í„° ìœ ì§€
- ì¬ë¡œê·¸ í›„ ì¬ì‹œë„

---

## 10. ìˆ˜ìš© ê¸°ì¤€ (í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤)

### TC-1: ìŠ¤í‚¤ë§ˆ ì¼ê´€ì„±
- ëª¨ë“  í”„ë¡œë°”ì´ë”ì—ì„œ `timestamp`, `minC/maxC`, `iconCode`ê°€ í‘œì¤€ í˜•íƒœë¡œ ì „ë‹¬ë¨

### TC-2: ë‹¨ìœ„ ë³€í™˜ ì •í™•ë„
- metric â†” imperial ì „í™˜ ì‹œ ëª¨ë“  ê°’ì´ ì •í™•íˆ ë³€í™˜ë¨ (Â±0.1Â°C, Â±0.1 km/h, Â±0.01 inHg)

### TC-3: SWR ë™ì‘
- ìºì‹œ ì¦‰ì‹œ í‘œì‹œ â†’ ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  â†’ UI ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ì—†ìŒ)

### TC-4: ê°€ì‹œì„±/ì·¨ì†Œ
- íƒ­ ì „í™˜/ì—°ì† ìœ„ì¹˜ ë³€ê²½ ì‹œ ì´ì „ ìš”ì²­ ì¤‘ë‹¨, ìµœì‹  ë°ì´í„°ë§Œ ë°˜ì˜

### TC-5: ì˜¤í”„ë¼ì¸ ëª¨ë“œ
- ë„¤íŠ¸ì›Œí¬ ì°¨ë‹¨ ì‹œ ë§ˆì§€ë§‰ ì •ìƒ ë°ì´í„° + ì˜¤í”„ë¼ì¸ ë°°ì§€ í‘œì‹œ
- ì˜¨ë¼ì¸ ë³µê·€ ì‹œ ìë™ ê°±ì‹ 

### TC-6: ì¼ë³„ ì§‘ê³„ ì •í™•ë„
- OpenWeather 3ì‹œê°„ ê°„ê²© ë°ì´í„°ë¡œë¶€í„° ì¼ë³„ min/max/ê°•ìˆ˜ëŸ‰/POP ì •í™• ê³„ì‚°
- ê²½ê³„ì¼(ìì • êµì°¨) ë°ì´í„° ì •í™•ë„ í™•ì¸

### TC-7: ì§€ì˜¤ì½”ë”©
- 'ì„œìš¸', 'Seoul', 'seo ul' ëª¨ë‘ ê²€ìƒ‰ ê°€ëŠ¥ (ì •ê·œí™” ê·œì¹™ ì ìš©)

### TC-8: ì ‘ê·¼ì„±
- Lighthouse A11y 95+
- í‚¤ë³´ë“œë§Œìœ¼ë¡œ ì„¤ì • ë³€ê²½/ê°±ì‹  ê°€ëŠ¥

### TC-9: ì„±ëŠ¥
- 1x3 ë·°ì—ì„œ INP < 200ms
- ë©”ëª¨ë¦¬ ë¦­/ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¤‘ë³µ ì—†ìŒ

### TC-10: ë³´ì•ˆ
- í”„ë¡ì‹œ ê²½ìœ  ì‹œ í´ë¼ì´ì–¸íŠ¸ ë²ˆë“¤ì—ì„œ API í‚¤ ê²€ìƒ‰ ë¶ˆê°€

---

## 11. ë‚©í’ˆë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ì„¤ê³„ ë¬¸ì„œ (ë³¸ ë¬¸ì„œ)
- [ ] í”„ë¡œë°”ì´ë” ì–´ëŒ‘í„° ë§¤í•‘í‘œ (ìƒì„¸)
- [ ] ì•„ì´ì½˜/ì¡°ê±´ ì½”ë“œ ë§¤í•‘í‘œ (ìƒì„¸)
- [ ] ìºì‹œ/SWR/ì·¨ì†Œ/ë°±ì˜¤í”„/í˜ì¼ì˜¤ë²„ íë¦„ë„
- [ ] ê°€ì‹œì„±/ìë™ ìƒˆë¡œê³ ì¹¨ ê·œì¹™
- [ ] ì˜¤í”„ë¼ì¸ UX ê·œê²©
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ
- [ ] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í‘œ
- [ ] ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì ˆì°¨
- [ ] í”„ë¡ì‹œ API ê³„ì•½ì„œ

